<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="pragma" content="no-cache"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <title>数据界面</title>
    <#include "common/include.html" />
    <script src="https://cdn.bootcss.com/socket.io/2.2.0/socket.io.js"></script>
</head>

<body class="no-skin">
<div class="main-container ace-save-state" id="main-container">
    <div class="main-content">
    	<div class="col-xs-12">
 		    <table class="table table-striped table-bordered table-hover">
                <tr>
                    <th class="center">连续天数</th><td><input name= "limit" value="7" /></td>
                    <th class="center">对比天数</th><td><input name= "num" value="30" /></td>
                    <th class="center">查询</th>
                </tr>
             </table>
    	</div>
        <div class="col-xs-12">
            <h3 class="header smaller lighter blue">数据面板</h3>
            <div>
                <table id="dynamic-table" class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th class="center">名称</th>
                            <th class="center">涨幅</th>
                            <th class="center">换手率</th>
                            <th class="center">推荐指数</th>
                            <th class="center">操作</th>
                            <th class="center">详情</th>
                        </tr>
                    </thead>
                    <tbody id="data">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">

    /**
     * 前端js的 socket.emit("事件名","参数数据")方法，是触发后端自定义消息事件的时候使用的,
     * 前端js的 socket.on("事件名",匿名函数(服务器向客户端发送的数据))为监听服务器端的事件
     **/
    var socket = io.connect("http://localhost:10001?mac=2");
    var firstconnect = true;

    function connect() {
        if(firstconnect) {

            socket.on('reconnect', function(){ status_update("Reconnected to Server"); });
            socket.on('reconnecting', function( nextRetry ){ status_update("Reconnecting in "
            + nextRetry + " seconds"); });
            socket.on('reconnect_failed', function(){ message("Reconnect Failed"); });
            firstconnect = false;
        } else {
            socket.socket.reconnect();
        }
    }

    //监听服务器连接事件
    socket.on('connect', function(){ status_update("Connected to Server"); });
    //监听服务器关闭服务事件
    socket.on('disconnect', function(){ status_update("Disconnected from Server"); });
    //监听服务器端发送消息事件
    socket.on('refreshData', function(data) {
        message(data)
        //console.log("服务器发送的消息是："+data);
    });

    //断开连接
    function disconnect() {
        socket.disconnect();
    }

    function message(data) {
        console.log(data);
    }

    function status_update(txt){
        console.log(txt);
    }

    function esc(msg){
        return msg.replace(/</g, '<').replace(/>/g, '>');
    }
    //点击发送消息触发
    function send() {
        console.log("点击了发送消息，开始向服务器发送消息")
        var msg = "我很好的,是的．";
        socket.emit('refreshData', {msgContent: msg});
    };
</script>
</html>


